{% extends "base.html" %}
{% block title %}Student Dashboard - SCE Request Portal{% endblock %}

{% block content %}
<h1 style="margin-bottom: 1.5rem;">My Requests</h1>

<div class="stats-grid">
    <div class="stat-card">
        <div class="stat-value">{{ total_requests }}</div>
        <div class="stat-label">Total Requests</div>
    </div>
    <div class="stat-card">
        <div class="stat-value" style="color: #f59e0b;">{{ in_progress }}</div>
        <div class="stat-label">In Progress</div>
    </div>
    <div class="stat-card">
        <div class="stat-value" style="color: #10b981;">{{ approved }}</div>
        <div class="stat-label">Approved</div>
    </div>
    <div class="stat-card">
        <div class="stat-value" style="color: #ef4444;">{{ rejected }}</div>
        <div class="stat-label">Rejected</div>
    </div>
</div>

<div class="card">
    <div class="card-header" style="display: flex; justify-content: space-between; align-items: center;">
        <h2 class="card-title">Requests</h2>
        <a href="{% url 'students:submit_request' %}" class="btn btn-primary">+ New Request</a>
    </div>
    
    <div class="filter-bar">
        <label>Filter by status:</label>
        <select onchange="window.location.href='?status=' + this.value">
            <option value="all" {% if status_filter == 'all' %}selected{% endif %}>All</option>
            <option value="new" {% if status_filter == 'new' %}selected{% endif %}>New</option>
            <option value="in_progress" {% if status_filter == 'in_progress' %}selected{% endif %}>In Progress</option>
            <option value="approved" {% if status_filter == 'approved' %}selected{% endif %}>Approved</option>
            <option value="rejected" {% if status_filter == 'rejected' %}selected{% endif %}>Rejected</option>
        </select>
    </div>
    
    {% if requests %}
    <table class="table">
        <thead>
            <tr>
                <th>Request ID</th>
                <th>Title</th>
                <th>Type</th>
                <th>Status</th>
                <th>Priority</th>
                <th>Date</th>
                <th>Actions</th>
            </tr>
        </thead>
        <tbody>
            {% for req in requests %}
            <tr>
                <td><strong>{{ req.request_id }}</strong></td>
                <td>{{ req.title }}</td>
                <td>{{ req.request_type }}</td>
                <td><span class="badge badge--{{ req.status }}">{{ req.get_status_display }}</span></td>
                <td><span class="badge badge--{{ req.priority }}">{{ req.get_priority_display }}</span></td>
                <td>{{ req.created_at|date:"M d, Y" }}</td>
                <td>
                    <a href="{% url 'students:request_detail' req.request_id %}" class="btn btn-outline">View</a>
                </td>
            </tr>
            {% endfor %}
        </tbody>
    </table>
    {% else %}
    <div class="empty-state">
        <div class="empty-state-icon">ðŸ“‹</div>
        <h3>No requests yet</h3>
        <p>Click "New Request" to submit your first request.</p>
    </div>
    {% endif %}
</div>

{% if notifications %}
<div class="card">
    <div class="card-header">
        <h2 class="card-title">Recent Notifications</h2>
    </div>
    <ul style="list-style: none; padding: 0;">
        {% for notif in notifications %}
        <li style="padding: 0.75rem 0; border-bottom: 1px solid #e5e7eb;">
            <span style="color: {% if notif.is_read %}#6b7280{% else %}#1f2937{% endif %};">{{ notif.message }}</span>
            <small style="color: #9ca3af; display: block;">{{ notif.created_at|timesince }} ago</small>
        </li>
        {% endfor %}
    </ul>
</div>
{% endif %}
{% endblock %}
